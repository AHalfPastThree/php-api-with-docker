# API на PHP для для каталога товаров

API поддерживает запросы с типом GET, POST, PUT и DELETE. 
Тип запроса определяется в родительском классе api.php. Он является абстрактным и от него наследуются классы конкретных api.
В зависимости от типа запроса, в родительском классе api выбирается метод, который будет его обрабатывать. Методы обработки реализуются в дочернем классе.
Так же в родительском классе определяется статус запроса, он может быть:
  - 200 => 'OK',
  - 400 => 'Bad Request',
  - 404 => 'Not Found',
  - 405 => 'Method Not Allowed',
  - 500 => 'Internal Server Error'

## Созданные API и запросы

Были созданы API для продуктов и категорий, был реализован CRUD для них, а так же при чтении отдельной категории так же отображаются все товары в ней. БД прилогаю.

## Работа с API

Все запросы перенаправляются Апачи на index.php. Перенаправление происходит с помощью .htaccess

```
	RewriteEngine on
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . index.php
```
Далее, в index.php выбираем, запускать api для продуктов или категорий. Классы их api подключены сверху.

```php
	require_once 'productapi.php';
	require_once 'categoriesapi.php';
	try {
	    if (stripos($_SERVER['REQUEST_URI'], "/products/")){     //Смотрим, какое апи запустить
	        $api = new ProductsApi();
	    }else{
	        $api = new CategoriesApi();
	    }
	    $api->indexAction();
	    echo $api->run();
	} catch (Exception $e) {
	    echo json_encode(Array('error' => $e->getMessage()));
	}
```
Далее, переходим к запросам. 

## Запросы 'products'

Первоначально, в дочернем классе api проверяется имя api. Первые 2 элемента массива URI должны быть "api" и название таблицы.

##### Запросы:
  - Запрос с методом GET на url http://ДОМПЕН/api/products выдаст список всех товаров;
  - Запрос c методом GET на url http://ДОМПЕН/api/products/1 выдаст конкретный товар, id которого - последний элемент url;
  - Запрос с методом POST на url http://ДОМПЕН/api/products + параметры запроса name, price, category создаст новый товар и добавит его в категорию. Можно указывать несколько категорий в параметре запроса, перечисляя их id через запятую;
  - Запрос c методом PUT на url http://ДОМПЕН/api/products/1 + параметры запроса name, price, category обновит конкретный товар, id которого - последний элемент url;
  - Запрос c методом DELETE на url http://ДОМПЕН/api/products/1 удалит конкретный товар, id которого - последний элемент url;

## Запросы 'categories'

Первые 2 элемента массива URI должны быть "api" и название таблицы.

##### Запросы:
  - Запрос с методом GET на url http://ДОМПЕН/api/categories выдаст список всех категорий, их id и имя;
  - Запрос c методом GET на url http://ДОМПЕН/api/categories/1 выдаст конкретную категорию, id которой - последний элемент url, а так же все товары в ней;
  - Запрос с методом POST на url http://ДОМПЕН/api/categories + параметр запроса category_name создаст новую категорию;
  - Запрос c методом PUT на url http://ДОМПЕН/api/categories/1 + параметр запроса category_name обновит конкретную категорию, id которой - последний элемент url;
  - Запрос c методом DELETE на url http://ДОМПЕН/api/categories/1 удалит конкретную категорию, id которого - последний элемент url, а так же отвяжет товары от удалённой категории;

## Примечания 

В примерах урлов для запросов 1 - для примера, это id. Проверял запросы через Postman.
Руденский Егор, 28.11.2019